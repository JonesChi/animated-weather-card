<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animated Weather Card Preview</title>
    <style>
        body {
            background-color: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: sans-serif;
        }

        .container {
            width: 489px;
        }
    </style>
    <!-- Mock Home Assistant dependencies -->
    <script type="module">
        console.log('Mocking HA components...');
        if (!customElements.get('ha-icon')) {
            customElements.define('ha-icon', class extends HTMLElement {
                set icon(val) { this.innerText = val; }
            });
        }
        if (!customElements.get('ha-card')) {
            customElements.define('ha-card', class extends HTMLElement {
                connectedCallback() {
                    this.style.display = 'block';
                    this.style.background = 'rgba(255, 255, 255, 0.1)';
                    this.style.borderRadius = '24px';
                    this.style.padding = '16px';
                }
            });
        }
    </script>
    <script type="module" src="./dist/animated-weather-card.js"></script>
</head>

<body>
    <div class="container">
        <div style="margin-bottom: 20px; color: white;">
            <label for="stateSelect">Weather State:</label>
            <select id="stateSelect">
                <option value="sunny" selected>Sunny</option>
                <option value="clear-night">Clear Night</option>
                <option value="cloudy">Cloudy</option>
                <option value="partlycloudy">Partly Cloudy</option>
                <option value="rainy">Rainy</option>
                <option value="pouring">Pouring</option>
                <option value="lightning">Lightning</option>
                <option value="lightning-rainy">Lightning Rainy</option>
                <option value="snowy">Snowy</option>
                <option value="snowy-rainy">Snowy Rainy</option>
                <option value="fog">Fog</option>
            </select>
        </div>
        <animated-weather-card id="weatherCard"></animated-weather-card>
    </div>

    <script type="module">
        const card = document.getElementById('weatherCard');
        const stateSelect = document.getElementById('stateSelect');

        console.log('Initializing mock data...');
        // Mock Home Assistant Object
        const hass = {
            states: {
                'weather.demo': {
                    state: 'sunny',
                    attributes: {
                        temperature: 22.5,
                        temperature_unit: '°C',
                        humidity: 45,
                        forecast: [
                            { datetime: '2025-12-21T12:00:00Z', condition: 'sunny', temperature: 25, templow: 18 },
                            { datetime: '2025-12-22T12:00:00Z', condition: 'cloudy', temperature: 22, templow: 16 },
                            { datetime: '2025-12-23T12:00:00Z', condition: 'rainy', temperature: 19, templow: 14 },
                            { datetime: '2025-12-24T12:00:00Z', condition: 'sunny', temperature: 24, templow: 17 },
                            { datetime: '2025-12-25T12:00:00Z', condition: 'sunny', temperature: 26, templow: 18 }
                        ],
                        supported_features: 0 // Legacy
                    }
                },
                'sun.sun': {
                    state: 'above_horizon'
                }
            },
            config: {
                time_zone: 'UTC',
                unit_system: {
                    temperature: '°C'
                }
            },
            locale: {
                language: 'en'
            },
            connection: {
                subscribeMessage: (callback, message) => {
                    console.log('Subscribed to forecast', message);
                    return () => Promise.resolve();
                }
            }
        };

        const config = {
            type: 'custom:animated-weather-card',
            entity: 'weather.demo',
            title: 'Météo',
            sun_entity: 'sun.sun',
            forecast_rows: 5
        };

        stateSelect.addEventListener('change', () => {
            hass.states['weather.demo'].state = stateSelect.value;
            card.hass = { ...hass }; // Trigger update
        });

        console.log('Waiting for animated-weather-card to be defined...');
        customElements.whenDefined('animated-weather-card').then(() => {
            console.log('animated-weather-card defined! Setting config and hass...');
            try {
                card.setConfig(config);
                card.hass = { ...hass };
                console.log('Init complete.');
            } catch (e) {
                console.error('Error setting card config:', e);
            }
        }).catch(err => {
            console.error('Failed to define animated-weather-card:', err);
        });
    </script>
</body>

</html>
